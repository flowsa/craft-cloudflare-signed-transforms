{% import "_includes/forms" as forms %}

{{ forms.autosuggestField({
    label: 'Worker URL'|t('cloudflare-signed-transforms'),
    instructions: 'The base URL of your Cloudflare Worker (e.g., https://pdf-thumbnail-worker.your-domain.workers.de/v1)'|t('cloudflare-signed-transforms'),
    id: 'workerUrl',
    name: 'workerUrl',
    value: settings.workerUrl,
    errors: settings.getErrors('workerUrl'),
    required: true,
    suggestEnvVars: true,
    placeholder: 'https://your-worker.workers.dev'
}) }}

{{ forms.autosuggestField({
    label: 'Signature Secret'|t('cloudflare-signed-transforms'),
    instructions: 'The HMAC secret key used to sign URLs. Must match the SIGNATURE_SECRET in your worker.'|t('cloudflare-signed-transforms'),
    id: 'signatureSecret',
    name: 'signatureSecret',
    value: settings.signatureSecret,
    errors: settings.getErrors('signatureSecret'),
    required: true,
    suggestEnvVars: true,
    type: 'password',
    placeholder: 'your-secret-key-here'
}) }}

{{ forms.textField({
    label: 'Default Expiration (seconds)'|t('cloudflare-signed-transforms'),
    instructions: 'Optional: Default time (in seconds) before signed URLs expire. Set to 0 for no expiration.'|t('cloudflare-signed-transforms'),
    id: 'defaultExpiration',
    name: 'defaultExpiration',
    value: settings.defaultExpiration,
    errors: settings.getErrors('defaultExpiration'),
    type: 'number',
    min: 0,
    placeholder: '0'
}) }}

<hr>

<h2>{{ 'Cache Purging'|t('cloudflare-signed-transforms') }}</h2>

{{ forms.lightswitchField({
    label: 'Enable Cache Purge'|t('cloudflare-signed-transforms'),
    instructions: 'Automatically purge cached images from Cloudflare when assets are updated or replaced.'|t('cloudflare-signed-transforms'),
    id: 'enableCachePurge',
    name: 'enableCachePurge',
    on: settings.enableCachePurge
}) }}

{{ forms.autosuggestField({
    label: 'Cloudflare Zone ID'|t('cloudflare-signed-transforms'),
    instructions: 'Your Cloudflare Zone ID (found in Dashboard → Overview). Required for cache purging.'|t('cloudflare-signed-transforms'),
    id: 'zoneId',
    name: 'zoneId',
    value: settings.zoneId,
    errors: settings.getErrors('zoneId'),
    suggestEnvVars: true,
    placeholder: 'your-zone-id'
}) }}

{{ forms.autosuggestField({
    label: 'Cloudflare API Key'|t('cloudflare-signed-transforms'),
    instructions: 'API Token with "Zone.Cache Purge" permission. Create at: My Profile → API Tokens.'|t('cloudflare-signed-transforms'),
    id: 'apiKey',
    name: 'apiKey',
    value: settings.apiKey,
    errors: settings.getErrors('apiKey'),
    type: 'password',
    suggestEnvVars: true,
    placeholder: 'your-api-token'
}) }}

<div class="field">
    <div class="heading">
        <label>{{ 'Manual Cache Purge'|t('cloudflare-signed-transforms') }}</label>
        <div class="instructions">
            <p>{{ 'Manually purge cached images from Cloudflare.'|t('cloudflare-signed-transforms') }}</p>
        </div>
    </div>
    <div class="input">
        <a href="{{ cpUrl('cloudflare-signed-transforms/cache') }}" class="btn">
            {{ 'Go to Cache Purge Utility'|t('cloudflare-signed-transforms') }}
        </a>
    </div>
</div>

<hr>

<div class="readable">
    <h2>{{ 'About Cloudflare Signed Transforms'|t('cloudflare-signed-transforms') }}</h2>

    <p>{{ 'This plugin transforms images and PDFs using a Cloudflare Worker with HMAC-signed URLs for security.'|t('cloudflare-signed-transforms') }}</p>

    <h3>{{ 'Features'|t('cloudflare-signed-transforms') }}</h3>
    <ul>
        <li>{{ 'Works with any public HTTPS URL (not limited to Cloudflare-managed domains)'|t('cloudflare-signed-transforms') }}</li>
        <li>{{ 'PDF support - automatically generates thumbnails from first page'|t('cloudflare-signed-transforms') }}</li>
        <li>{{ 'HMAC-SHA256 signed URLs for security'|t('cloudflare-signed-transforms') }}</li>
        <li>{{ 'Optional expiration timestamps for time-limited access'|t('cloudflare-signed-transforms') }}</li>
        <li>{{ 'Full Cloudflare Images API transform support'|t('cloudflare-signed-transforms') }}</li>
    </ul>

    <h3>{{ 'Setup'|t('cloudflare-signed-transforms') }}</h3>
    <ol>
        <li>{{ 'Deploy the Cloudflare Worker from the repository'|t('cloudflare-signed-transforms') }}</li>
        <li>{{ 'Set the SIGNATURE_SECRET in your worker using: npx wrangler secret put SIGNATURE_SECRET'|t('cloudflare-signed-transforms') }}</li>
        <li>{{ 'Enter your worker URL and the same secret key above'|t('cloudflare-signed-transforms') }}</li>
        <li>{{ 'Optionally configure default expiration time for signed URLs'|t('cloudflare-signed-transforms') }}</li>
    </ol>

    <p>
        <a href="https://github.com/flowsa/craft-cloudflare-signed-transforms" target="_blank" rel="noopener">
            {{ 'Documentation'|t('cloudflare-signed-transforms') }}
        </a>
    </p>
</div>
